<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>스마트 재고 관리 프로그램</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Gugi&display=swap" rel="stylesheet">
    <style>
      h1 {
        font-family: 'Gugi', cursive;
        font-size: 50px;
      }

      h2 {
        font-family: 'Gugi', cursive;
        font-size: 20px;
        color: rgb(101, 100, 104);
        text-align: center;
      }

      p { margin:20px 0px; }

      #ingredient_input {
        
        font-size: 25px;
        width: auto;
        margin: 10px auto;
        border: 3px solid rgb(14, 3, 2);
        padding: 20px;
        border-radius: 10px;
      }
      .box1 {
        border: 3px solid rgb(83, 82, 85);
        padding: 10px;
        border-radius: 10px;
      
      }
      .ing_list_title {
        font-size: 30px;
        text-align: center;
        font-weight: bold;
      }
      #logo {
        margin-right: 20px;

      }
      .box2 {
        border: 3px solid rgb(83, 82, 85);
        padding: 10px;
        border-radius: 10px;
        text-align: center;
        margin: 0 auto 0 auto;

      }
      #box3 {
        border: 3px solid rgb(83, 82, 85);
        padding: 10px;
        border-radius: 10px;
        text-align: center;
        margin: 0 auto 0 auto;

      }

    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col">
          <br>
          <img id="logo" src="../src/logo2.png" width="100px", height="100px" style="float: left" >
          <p><h1>스마트 재고 관리 프로그램</h1></p>
          <br>
        
          
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link active" data-toggle="tab" href="#ingredient">재료</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#order">주문</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#order_validity">주문가능량</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-toggle="tab" href="#input_recipe">레시피 입력</a>
              </li>
            </ul>

            <br>
            <br>

            <form id="ingredient_input">
            <div class="tab-content">
              <div class="tab-pane fade show active" id="ingredient">
                
                
                
                <div class = "box2">
                <p style="font-size: 30px;"><재료 입력란></p>
                <p>재료명, 수량, 원가, 유통기한을 입력하고 입력하기 버튼을 누르세요</p>
                <div class="input-group mb-3">

                  <div class="input-group-prepend">
                    <span class="input-group-text" >재료명</span>
                  </div>
                  <input type="text" class="form-control" id="ingredient_name" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text">수량</span>
                  </div>
                  <input type="number" class="form-control" id="ingredient_quantity" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                </div>

                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text">원가</span>
                  </div>
                  <input type="number" class="form-control" id="ingredient_production_cost" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                </div>
                
                <div class="input-group mb-3">
                  <div class="input-group-prepend">
                    <span class="input-group-text">유통기한</span>
                </div>
                  <input type="date" class="form-control" value="" id ="ingredient_expiration_date">
                </div>
                
              

              <div class="submitButton">
                <button type="button" class="btn btn-primary" onclick="input_ingredient()">
                  재료 입력하기
                </button>
              </div>
            </div>
              <br>
              <div class = "box1">
              <p class = "ing_list_title"><현재 재료 리스트></p>
              <div class="ingredients">
                <table class="table">
                    <thead>
                        <tr>
                            <th class="meta_info" scope="col">재료명</th>
                            <th class="meta_info" scope="col">수량</th>
                            <th class="meta_info" scope="col">원가</th>
                            <th class="meta_info" scope="col">유통기한</th>
                        </tr>
                    </thead>
                    <tbody id="ingredients-box">
                        <tr>
                            <td>Otto</td>
                            <td>@mdo</td>
                            <td>@mdo</td>
                            <td>@mdo</td>
                        </tr>
                    </tbody>
                </table>
                </div>
              </div>
            <br>
<div id = "box3">
              <p><재료 수정란></p>
              <p>현재 있는 재료 중 수정하고 싶은 재료를 입력하고, 수정할 값을 입력하세요</p>
            <div class="input-group mb-3">
              <div class="input-group-prepend">
                <span class="input-group-text" >현 재료명</span>
              </div>
              <input type="text" class="form-control" id="now_ingredient_name" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
              <div class="input-group-prepend">
                <span class="input-group-text" >수정 재료명</span>
              </div>
              <input type="text" class="form-control" id="change_ingredient_name" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
            </div>

            <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text">현 수량</span>
            </div>
            <input type="number" class="form-control" id="now_ingredient_quantity" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
            <div class="input-group-prepend">
              <span class="input-group-text">수정 수량</span>
            </div>
            <input type="number" class="form-control" id="change_ingredient_quantity" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text">현 원가</span>
            </div>
            <input type="number" class="form-control" id="now_ingredient_production_cost" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
            <div class="input-group-prepend">
              <span class="input-group-text">수정 원가</span>
            </div>
            <input type="number" class="form-control" id="change_ingredient_production_cost" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
          </div>

          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text">현 유통기한</span>
            </div>
            <input type="date" class="form-control" id="now_ingredient_expiration_date" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
            <div class="input-group-prepend">
              <span class="input-group-text">수정 유통기한</span>
            </div>
            <input type="date" class="form-control" id="change_ingredient_expiration_date" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
          </div>
      

        <div class="submitButton">
          <button type="button" class="btn btn-primary" onclick="change_ingredient()">
            재료 수정하기
          </button>
        </div>
        </div>
            
              </div>
         
             

            </form>

              <div class="tab-pane fade" id="order">
                <p>주문받은 날짜와 메뉴와 수량을 입력하세요</p>
                <br>
                  <div>주문날짜입력
                    <form>
                      <p><input type="date" id="now_date"></p>
                    </div>
                <form>
                  <table id='menu_table'>
                      <thead id='menu_thead'>
                          <tr>
                              <td>
                                  <div>메뉴</div>   
                              </td>
                              <td>
                                <div>수량</div>
                                </td>
                          </tr>
                      </thead>
                      <tbody id='menu_tbody'>
                          <tr>
                              <td><input type='text'  id='menu_name_0'  placeholder="메뉴를 입력하세요"></td>
                              <td><input type='number'  id= 'menu_quantity_0' placeholder="주문 수량을 입력하세요"></td>
                          </tr>
                      </tbody>
                  </table>
                  <input type=button value="메뉴 입력칸 추가" onclick="add_menu_row()">
                  
                  <input type=button value="메뉴 입력칸 삭제" onclick="del_menu_row()">
                  <div class="submitButton">
                    <button type="button" class="btn btn-primary" onclick="input_order()">
                      주문 입력하기
                    </button>
                    <span> <p> ↑ 위의 버튼을 누르면 주문에 필요한 만큼 재료가 차감됩니다. </p></span>
                  </div>
                  </form>
                  <div class="orders">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="meta_info" scope="col">주문날짜</th>
                                <th class="meta_info" scope="col">주문 메뉴</th>
                                <th class="meta_info" scope="col">주문 수량</th>
                            </tr>
                        </thead>
                        <tbody id="orders-box">
                            <tr>
                                <td>2020-04-16</td>
                                <td>테스트,메뉴1, 메뉴2, 메뉴3, 메뉴4, 메뉴5</td>
                                <td>1,2,3,4,5</td>
                            </tr>
                            <tr>
                              <td>2020-04-17</td>
                              <td>테스트,메뉴1, 메뉴3, 메뉴4, 메뉴5</td>
                              <td>1,2,3,4</td>
                          </tr>
                        </tbody>
                    </table>
                </div>




              </div>


              <div class="tab-pane fade" id="order_validity">
                <p>현재 남아있는 재료로 만들 수 있는 각 메뉴의 최대수량을 보여줍니다.</p>
                <div class="orders">
                  <table class="table">
                      <thead>
                          <tr>
                              <th class="meta_info" scope="col">주문 가능한 메뉴</th>
                              <th class="meta_info" scope="col">주문 최대 가능량</th>
                              
                          </tr>
                      </thead>
                      <tbody id="order_available_box">
                          <tr>
                              <td>메뉴1</td>
                              <td>10</td>
                          </tr>
                          <tr>
                            <td>메뉴2</td>
                            <td>20</td>
                        </tr>
                        <tr>
                          <td>메뉴3</td>
                          <td>30</td>
                      </tr>
                      </tbody>
                  </table>
              </div>

              </div>


              <div class="tab-pane fade" id="input_recipe">
                <p>새로운 메뉴를 추가하려면 메뉴명과 가격을 입력하고, 그에 필요한 재료와 재료수량을 입력하세요</p>
                <form>
                  
                
                  <table id='recipe_table'>
                      <thead id='recipe_thead'>
                          <tr>
                              <td>
                                  <input type=text id="input_menu_name" placeholder="메뉴명을 입력하세요"> 
                                  
                              </td>
                              <td>
                                <input type='number' id="input_menu_price" placeholder="가격을 입력하세요"><span>원</span>
                              </td>
                          </tr>
                      </thead>
                      <tbody id='recipe_tbody'>
                          <tr>
                              <td><input type='text' id= 'recipe_ingredient_name_0'  placeholder="필요한 재료를 입력하세요"></td>
                              <td><input type='number' id= 'recipe_ingredient_quantity_0' placeholder="필요한 재료수량을 입력하세요"></td>
                          </tr>
                      </tbody>
                  </table>
                  <input type=button value="재료 입력칸 추가" onclick="add_recipe_row();">
                  
                  <input type=button value="재료 입력칸 삭제" onclick="del_recipe_row();">
                  
                  <div class="submitButton">
                    <button type="button" class="btn btn-primary" onclick="input_recipe()">
                      레시피 입력하기
                    </button>
                  </div>
                  </form>
                 

                  <div class="recipes">
                    <table class="table">
                        <thead>
                            <tr>
                                
                                <th class="meta_info" scope="col">메뉴명</th>
                                <th class="meta_info" scope="col">가격</th>
                                <th class="meta_info" scope="col">필요한 재료</th>
                                <th class="meta_info" scope="col">필요한 수량</th>
                            </tr>
                        </thead>
                        <tbody id="recipes-box">
                            <tr>
                                
                                <td>메뉴1</td>
                                <td>10000</td>
                                <td>설탕, 소금, 후추</td>
                                <td>1,2,3</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
              </div>



            </div>
        </div>
      </div>
      <h2>designed by junghwan</h2>
    </div>
    
  
  
  
  
  
  
  <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>

    <script>
      function input_ingredient() {
       
        let ingredient_name = $("#ingredient_name").val();
        let ingredient_quantity = $("#ingredient_quantity").val();
        let ingredient_production_cost = $("#ingredient_production_cost").val();
        let ingredient_expiration_date = $("#ingredient_expiration_date").val();

        if (ingredient_name == "") {
          alert("재료명을 입력하세요");
          $("#ingredient_name").focus();
          return
        }
        else if (ingredient_quantity < 1) {
          alert("수량을 입력하세요");
          $("#ingredient_quantity").focus();
          return
        }
        else if (ingredient_production_cost== "") {
          alert("원가를 입력하세요");
          $("#ingredient_production_cost").focus();
          return
        }
        else if (ingredient_expiration_date == false) {
          alert("유통기한을 입력하세요");
          $("#ingredient_expiration_date").focus();
          return
        }
        $.ajax({
                    type: "POST",
                    url: "/ingredients",
                    data: {
                       ingredient_give: ingredient_name,
                        quantity_give: ingredient_quantity,
                         production_cost_give: ingredient_production_cost,
                          expiration_date_give : ingredient_expiration_date
                           },
                    success: function (response) {
                        if (response['result'] == 'success') {
                            alert(response['msg']);
                            window.location.reload();
                        }
                    },
                    error:function(request,status,error){
             alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
          }

                })

      }

      $(document).ready(function () {
                $('#ingredients-box').html('');
                listing_ingredients();
            });

            function listing_ingredients() {
                $.ajax({
                    type: "GET",
                    url: "/ingredients",
                    data: {},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            let ingredients_list = response['ingredients'];
                            for (let i = 0; i < ingredients_list.length; i++) {
                                make_card(ingredients_list[i]['ingredient'], ingredients_list[i]['quantity'], ingredients_list[i]['production_cost'],ingredients_list[i]['expiration_date']);
                            }
                        } else {
                            alert('재료리스트를 불러오지 못했습니다');
                            
                            
                        }
                    }
                })
            }
    
            function make_card(ingredient_name, ingredient_quantity, ingredient_production_cost, ingredient_expiration_date) {
                let temp_html = '<tr>\
                                    <td>'+ ingredient_name + '</td>\
                                    <td>'+ ingredient_quantity + '</td>\
                                    <td>'+ ingredient_production_cost + '</td>\
                                    <td>'+ ingredient_expiration_date + '</td>\
                                </tr>';
                $('#ingredients-box').append(temp_html);
            }
    </script>

  <!--레시피 입력 탭 버튼으로 칸 추가-->
<script>

  var menu_row_count = 1;
  var recipe_row_count =1;
  var menu_table = document.getElementById('menu_table');
  var menu_thead = document.getElementById('menu_thead');
  var menu_tbody = document.getElementById('menu_tbody');
  var menu_tr = null;
  var menu_td = null;
  var menu_x = 0;
  var menu_y = 0;

  function add_menu_row() {
    
      let menu_row = `
          <tr>
            <td><input id="menu_name_${menu_row_count}" placeholder="메뉴를 입력하세요" /></td>
            <td><input id="menu_quantity_${menu_row_count}" placeholder="주문 수량을 입력하세요" /></td>
        </tr>
          `;
      $("#menu_tbody").append(menu_row);
      menu_row_count = menu_row_count + 1;
  }
  function del_menu_row()
  {
      var menu_tbody_tr = menu_tbody.getElementsByTagName('tr');
      if (menu_tbody_tr.length > 1) {
          menu_tbody.deleteRow(menu_tbody_tr.length-1);
          menu_row_count = menu_row_count - 1;
          
      }
  }

  function add_recipe_row() {

let recipe_row = `
        <tr>
          <td><input type='text'  id= 'recipe_ingredient_name_${recipe_row_count}'  placeholder="필요한 재료를 입력하세요"></td>
          <td><input type='number'   id= 'recipe_ingredient_quantity_${recipe_row_count}' placeholder="필요한 재료수량을 입력하세요"></td>
        </tr>
      `;
  $("#recipe_tbody").append(recipe_row);
  recipe_row_count = recipe_row_count + 1;


}

  function del_recipe_row() {
    var recipe_tbody_tr = recipe_tbody.getElementsByTagName('tr');
      if (recipe_tbody_tr.length > 1) {
          recipe_tbody.deleteRow(recipe_tbody_tr.length-1);
          recipe_row_count = recipe_row_count - 1;

          
      }

  }

//주문 입력하기
  function input_order() {
    
    let menu_date = $("#now_date").val();
    
    /*
        if (menu_name_ == "") {
          alert("메뉴명을 입력하세요");
          $("#menu_name_" + i).focus();
          return
        }
        else if (menu_quantity_ = "") {
          alert("수량을 입력하세요");
          $("#menu_quantity_" + i).focus();
          return
        }
        else if (menu_date = "") {
          alert("주문 받은 날짜를 입력하세요");
          $("#now_date").focus();
          return
        }
*/

    let menus = []
    for (let i = 0; i < menu_row_count; i++) {
      let menu_name = $("#menu_name_" + i).val();
      let menu_quantity = $("#menu_quantity_" + i).val();
      menus.push({'name':menu_name, 'quantity':menu_quantity})
      
      }
      console.log(menus)
      menus = JSON.stringify(menus);


        $.ajax({
                    type: "POST",
                    url: "/menus",
                    data: { 
                            menus_give : menus, 
                            menu_date_give : menu_date 
                          },
                    success: function (response) {
                        if (response['result'] == 'success') {
                            alert(response['msg']);
                            window.location.reload();
                        }
                        
                    },
                    error:function(request,status,error){
             alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
          }

                })
  }

  $(document).ready(function () {
                $('#orders-box').html('');
                listing_orders();
            

            });

  function listing_orders() {
                $.ajax({
                    type: "GET",
                    url: "/menus",
                    data: {},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            let orders_list = response['orders'];
                           
                           /////이부분 다시!!! 리스트 속 딕셔너리에서 메뉴명, 수량 따로 따로 어떻게 불러올건지? 
                            for (let i = 0; i < orders_list.length; i++) {
                              let date = orders_list[i]['menu_date']
                              let menus = JSON.parse(orders_list[i]['menus'])
                              for(let j=0; j< menus.length; j++) {
                                let name = menus[j]['name']
                                let quantity = menus[j]['quantity']

                                if(j == 0) {
                                  make_orders_box(date, name, quantity)
                                } else {
                                  make_orders_box('', name, quantity)
                                }
                                
                              }                               
                            }

                        } 
                        
                        else {
                            alert('주문리스트를 불러오지 못했습니다');
                            
                        }
                    }
                })
          }
            
            function make_orders_box(x,y,z) {
              let orders_temp = '<tr>\
                                    <td>'+ x + '</td>\
                                    <td>'+ y + '</td>\
                                    <td>'+ z + '</td>\
                                </tr>';
                $('#orders-box').append(orders_temp);
            }
  
  
 
  function add_name(name)
  {
      var inp = document.createElement('input');
      inp.setAttribute('type', 'text');
      inp.setAttribute('placeholder', '필요한 재료를 입력하세요');
      inp.setAttribute('name', name);
      stock_td.appendChild(inp);
  }
  function add_count(count)
  {
      var inp = document.createElement('input');
      inp.setAttribute('type', 'number');
      inp.setAttribute('placeholder', '필요한 재료수량을 입력하세요');
      inp.setAttribute('name', count);
      stock_td.appendChild(inp);
  }
 
 
  
 
  </script>


<!--주문 입력 탭 버튼으로 칸 추가-->
<script>
  
  
  /*
  function add_recipe_row() 
  {
      // 행 제목 추가
      menu_tr = document.createElement('tr');
      menu_tbody.appendChild(menu_tr);
      menu_td = document.createElement('td');
      menu_tr.appendChild(menu_td);
      add_menu_name('opty_subj[]');
      menu_y++;
  
      // 열의 갯수에 따라 추가된 행의 열 추가
      var menu_thead_td = menu_thead.getElementsByTagName('td');
      for (i=0; i<menu_thead_td.length-1; i++)
      {
          menu_td = document.createElement('td');
          menu_tr.appendChild(menu_td);
          add_menu_count('opt['+menu_y+'][]');
         
      }
  }
  
  
  
  function add_menu_name(name)
  {
      var inp = document.createElement('input');
      inp.setAttribute('type', 'text');
      inp.setAttribute('placeholder', '메뉴를 입력하세요');
      inp.setAttribute('name', name);
      menu_td.appendChild(inp);
  }
  function add_menu_count(count)
  {
      var inp = document.createElement('input');
      inp.setAttribute('type', 'number');
      inp.setAttribute('placeholder', '주문 수량을 입력하세요');
      inp.setAttribute('name', count);
      menu_td.appendChild(inp);
  }
  */
  

  
 
  </script>

<!--오늘날짜 입력-->
<script>
  document.getElementById('now_date').valueAsDate = new Date();
  </script>
  
  <!--재료 수정 ajax-->
  <script>
    function change_ingredient() {
        let now_ingredient_name = $("#now_ingredient_name").val();
        let now_ingredient_quantity = $("#now_ingredient_quantity").val();
        let now_ingredient_production_cost = $("#now_ingredient_production_cost").val();
        let now_ingredient_expiration_date = $("#now_ingredient_expiration_date").val();
        let change_ingredient_name = $("#change_ingredient_name").val();
        let change_ingredient_quantity = $("#change_ingredient_quantity").val();
        let change_ingredient_production_cost = $("#change_ingredient_production_cost").val();
        let change_ingredient_expiration_date = $("#change_ingredient_expiration_date").val();

        if (now_ingredient_name == "") {
          alert("현 재료명을 입력하세요");
          $("#now_ingredient_name").focus();
          return
        }
        else if (change_ingredient_name =="") {
          alert("수정 재료명을 입력하세요");
          $("#change_ingredient_name").focus();
          return
        }
        else if (now_ingredient_quantity == "") {
          alert("현 수량을 입력하세요");
          $("#now_ingredient_quantity").focus();
          return
        }
        else if (change_ingredient_quantity =="") {
          alert("수정 수량을 입력하세요");
          $("#change_ingredient_quantity").focus();
          return
        }
        else if (now_ingredient_production_cost== "") {
          alert("현재 원가를 입력하세요");
          $("#now_ingredient_production_cost").focus();
          return
        }
        else if (change_ingredient_production_cost== "") {
          alert("수정 원가를 입력하세요");
          $("#change_ingredient_production_cost").focus();
          return
        }
        else if (now_ingredient_expiration_date == false) {
          alert("현재 유통기한을 입력하세요");
          $("#now_ingredient_expiration_date").focus();
          return
        }
        else if (now_ingredient_expiration_date == false) {
          alert("수정 유통기한을 입력하세요");
          $("#change_ingredient_expiration_date").focus();
          return
        }
        $.ajax({
                    type: "POST",
                    url: "/change_ingredients",
                    data: {     now_ingredient_name_give: now_ingredient_name,
                                now_ingredient_quantity_give: now_ingredient_quantity,
                                now_ingredient_production_cost_give: now_ingredient_production_cost ,
                                now_ingredient_expiration_date_give : now_ingredient_expiration_date,
                                change_ingredient_name_give : change_ingredient_name,
                                change_ingredient_quantity_give : change_ingredient_quantity,
                                change_ingredient_production_cost_give : change_ingredient_production_cost,
                                change_ingredient_expiration_date_give : change_ingredient_expiration_date
                        },
                    success: function (response) {
                        if (response['result'] == 'success') {
                            alert(response['msg']);
                            $('#now_ingredient_name').val();
                            $('#now_ingredient_quantity').val();
                            $('#now_ingredient_production_cost').val();
                            $('#now_ingredient_expiration_date').val();
                            $('#change_ingredient_name').val();
                            $('#change_ingredient_quantity').val();
                            $('#change_ingredient_production_cost').val();
                            $('#change_ingredient_expiration_date').val();
                            window.location.reload();
                        }
                    },
                    error:function(request,status,error){
             alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
          }

                })

}

  </script>


  <!--레시피 추가 함수 만들기-->
  <script>
function input_recipe() {
let recipe_menu_name = $("#input_menu_name").val();
let recipe_menu_price = $("#input_menu_price").val();

let recipe_ingredients = []
    for (let i = 0; i < recipe_row_count; i++) {
      let recipe_ingredient_name = $("#recipe_ingredient_name_" + i).val();
      let recipe_ingredient_quantity = $("#recipe_ingredient_quantity_" + i).val();
      recipe_ingredients.push({'ingredients':recipe_ingredient_name, 'ingredients_need_quantity':recipe_ingredient_quantity})
      
      }
      recipe_ingredients = JSON.stringify(recipe_ingredients);

 $.ajax({
                    type: "POST",
                    url: "/recipes",
                    data: { 
                            menu_name_give : recipe_menu_name, 
                            menu_price_give : recipe_menu_price,
                            recipe_list_give : recipe_ingredients 
                          },
                    success: function (response) {
                        if (response['result'] == 'success') {
                            alert(response['msg']);
                            
                        }
                    },
                    error:function(request,status,error){
             alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
          }

                })


}
$(document).ready(function () {
                $('#recipes-box').html('');
                listing_recipes();
            

            });

  function listing_recipes() {
                $.ajax({
                    type: "GET",
                    url: "/recipes",
                    data: {},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            let recipes_list = response['recipes'];
                           
                         
                            for (let i = 0; i < recipes_list.length; i++) {
                              let recipe_name = recipes_list[i]['menu_name'];
                              let recipe_price = recipes_list[i]['menu_price']
                              let recipe_ingredients = JSON.parse(recipes_list[i]['recipe_list'])
                              for(let j=0; j< recipe_ingredients.length; j++) {
                                let name = recipe_ingredients[j]['ingredients']
                                let quantity = recipe_ingredients[j]['ingredients_need_quantity']
                                
                                if(j == 0) {
                                  make_recipes_box(recipe_name, recipe_price, name, quantity)
                                } else {
                                  make_recipes_box('','', name, quantity)
                                }
                                
                              }                               
                            }

                        } else {
                            alert('주문리스트를 불러오지 못했습니다');
                            
                        }
                    }
                })
          }
            
            function make_recipes_box(a,b,x,y) {
              let recipes_temp = '<tr>\
                                    <td>'+ a + '</td>\
                                    <td>'+ b + '</td>\
                                    <td>'+ x + '</td>\
                                    <td>'+ y + '</td>\
                                </tr>';
                $('#recipes-box').append(recipes_temp);
            }




//최대 주문 가능량 리스트 만들기
$(document).ready(function () {
                $('#order_available_box').html('');
                listing_order_available();
            

            });

  function listing_order_available() {
                $.ajax({
                    type: "GET",
                    url: "/max_menu",
                    data: {},
                    success: function (response) {
                        if (response['result'] == 'success') {
                            let counted_menus = response['counted_menus'];
                           
                         
                            for (let i = 0; i < counted_menus.length; i++) {
                              let name = counted_menus[i]['name'];
                              let count = counted_menus[i]['count']
                              make_available_menu_box(name,count)
                                
                              }                               
                            }
                            else {
                            alert('주문리스트를 불러오지 못했습니다');
                            
                        }
                        } 
                    }
                )
          }
            
            function make_available_menu_box(a,b) {
              let available_menu = '<tr>\
                                    <td>'+ a + '</td>\
                                    <td>'+ b + '</td>\
                                </tr>';
                $('#order_available_box').append(available_menu);
            }


  </script>


  </body>
</html>